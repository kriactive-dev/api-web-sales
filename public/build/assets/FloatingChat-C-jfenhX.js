import{h as B,l as n,c as d,b as r,d as j,T as k,j as T,f as D,F,n as S,J as b,t as V,w as $,v as q,p as E,q as w,o as f,_ as N}from"./app-ByZHPx0Q.js";const I={class:"fixed bottom-4 right-4 z-50 font-sans"},M={key:0,class:"w-[400px] h-[600px] bg-white rounded-lg shadow-2xl flex flex-col overflow-hidden mt-3 border border-gray-200"},O={class:"p-3 border-t bg-gray-50"},z=B({__name:"FloatingChat",setup(H){const i=n(!1),c=n(""),s=n([]),v=n(null),l=n({}),u=n(null),x=()=>{i.value=!i.value,i.value&&s.value.length===0&&y(),w(()=>{var o;(o=u.value)==null||o.scrollTo({top:u.value.scrollHeight})})},y=async()=>{const t=await(await fetch("/api/frontend-chatbot")).json();v.value=t.id,s.value.push({from:"bot",text:t.message}),l.value={},t.answers.forEach((e,a)=>{const h=`${a+1}ï¸âƒ£ ${e.label}`;s.value.push({from:"bot",text:h}),l.value[(a+1).toString()]=e.id})},_=async()=>{const o=c.value.trim();if(!o)return;s.value.push({from:"user",text:o}),c.value="";const t=l.value[o];if(!t){s.value.push({from:"bot",text:"Por favor, selecione uma opÃ§Ã£o vÃ¡lida (ex: 1, 2, 3...)"});return}try{const a=await(await fetch("/api/frontend-chatbot/answer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:t})})).json();if(a.type==="question"){const p=await(await fetch(`/api/frontend-chatbot/question/${a.id}`)).json();v.value=p.id,s.value.push({from:"bot",text:p.body}),l.value={},p.answers.forEach((m,g)=>{const C=`${g+1}ï¸âƒ£ ${m.title}`;s.value.push({from:"bot",text:C}),l.value[(g+1).toString()]=m.id})}else s.value.push({from:"bot",text:a.response})}catch{s.value.push({from:"bot",text:"Erro ao comunicar com o servidor."})}w(()=>{var e;(e=u.value)==null||e.scrollTo({top:u.value.scrollHeight})})};return(o,t)=>(f(),d("div",I,[r("button",{onClick:x,class:"w-14 h-14 rounded-full bg-ucmBlue text-white shadow-lg flex items-center justify-center text-2xl hover:bg-ucmBlueDark transition-colors"}," ðŸ’¬ "),j(k,{name:"fade"},{default:T(()=>[i.value?(f(),d("div",M,[r("div",{class:"bg-ucmBlue text-white px-4 py-3 flex justify-between items-center"},[t[1]||(t[1]=r("span",{class:"font-semibold"},"Assistente Virtual UCM",-1)),r("button",{onClick:x,class:"text-white text-lg hover:text-gray-200"},"âœ–")]),r("div",{class:"flex-1 p-4 overflow-y-auto space-y-3",ref_key:"messageBox",ref:u},[(f(!0),d(F,null,S(s.value,(e,a)=>(f(),d("div",{key:a,class:b(["flex",e.from==="user"?"justify-end":"justify-start"])},[r("div",{class:b([e.from==="user"?"bg-ucmBlue text-white rounded-t-xl rounded-bl-xl":"bg-gray-100 text-gray-800 rounded-t-xl rounded-br-xl","px-4 py-2 max-w-[80%] text-sm shadow-sm"])},V(e.text),3)],2))),128))],512),r("div",O,[$(r("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>c.value=e),onKeyup:E(_,["enter"]),class:"w-full px-4 py-2 border border-gray-300 rounded-full text-sm focus:outline-none focus:border-ucmBlue focus:ring-1 focus:ring-ucmBlue",placeholder:"Digite sua mensagem..."},null,544),[[q,c.value]])])])):D("",!0)]),_:1})]))}}),K=N(z,[["__scopeId","data-v-793d845d"]]);export{K as F};
